<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫–∞—Ä—Ç—ã - EventHub</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey={{ YANDEX_MAPS_API_KEY }}&lang=ru_RU"></script>
    <style>
        #map { 
            width: 100%; 
            height: 500px; 
            border: 3px solid #e61e4d;
            background: #f8f9fa;
        }
        .debug-info {
            padding: 20px;
            background: #f1f3f4;
            margin: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>üöÄ –¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h1>
    
    <div class="debug-info">
        <h3>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h3>
        <p>API Key: <strong>{{ YANDEX_MAPS_API_KEY|default:"NOT SET" }}</strong></p>
        <p>Events count: <strong>{{ events_count }}</strong></p>
        <button onclick="testMap()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É</button>
        <button onclick="checkElements()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã</button>
    </div>

    <div id="map">
        <div style="padding: 20px; text-align: center;">
            <h3>–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã</h3>
            <p>–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ, —ç–ª–µ–º–µ–Ω—Ç #map —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>
        </div>
    </div>

    <script>
        console.log('=== MAP TEST TEMPLATE LOADED ===');
        console.log('API Key:', '{{ YANDEX_MAPS_API_KEY }}');
        console.log('Map container:', document.getElementById('map'));
        console.log('ymaps defined:', typeof ymaps);

        function checkElements() {
            const elements = {
                map: document.getElementById('map'),
                ymaps: typeof ymaps,
                eventsData: window.EVENTS_DATA
            };
            console.log('Elements check:', elements);
            alert(`–ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:\n- #map: ${elements.map ? '–ù–ê–ô–î–ï–ù' : '–ù–ï –ù–ê–ô–î–ï–ù'}\n- ymaps: ${elements.ymaps}\n- eventsData: ${elements.eventsData ? elements.eventsData.length + ' events' : 'NOT FOUND'}`);
        }

        function testMap() {
            console.log('=== TESTING MAP ===');
            
            if (!document.getElementById('map')) {
                alert('‚ùå –≠–ª–µ–º–µ–Ω—Ç #map –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }

            if (typeof ymaps === 'undefined') {
                alert('‚ùå –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
                return;
            }

            ymaps.ready(function() {
                try {
                    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                    document.getElementById('map').innerHTML = '';
                    
                    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
                    const map = new ymaps.Map('map', {
                        center: [55.76, 37.64],
                        zoom: 10,
                        controls: ['zoomControl', 'typeSelector']
                    });

                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –º–∞—Ä–∫–µ—Ä—ã
                    const markers = [
                        [55.76, 37.64, '–¢–µ—Å—Ç 1 - –¶–µ–Ω—Ç—Ä'],
                        [55.75, 37.65, '–¢–µ—Å—Ç 2 - –°–º–µ—â–µ–Ω–∏–µ'],
                        [55.77, 37.63, '–¢–µ—Å—Ç 3 - –î—Ä—É–≥–æ–π —Ä–∞–π–æ–Ω']
                    ];

                    markers.forEach(([lat, lon, title]) => {
                        const placemark = new ymaps.Placemark([lat, lon], {
                            balloonContent: `<strong>${title}</strong><br>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä`
                        }, {
                            preset: 'islands#redIcon'
                        });
                        map.geoObjects.add(placemark);
                    });

                    alert('‚úÖ –ö–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.');
                    console.log('‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');

                } catch (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                    console.error('Map error:', error);
                }
            });
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, running auto-test...');
            setTimeout(testMap, 1000);
        });
    </script>
</body>
</html>